name: DROP Backend CI

on:
    pull_request:
        paths:
            - "**"
            - ".github/**"
        branches: [ main, dev ]
    push:
        branches: [ main, dev ]

permissions:
    contents: read
    checks: write
    pull-requests: write

jobs:
    backend-test:
        runs-on: ubuntu-latest

        env:
            SPRING_PROFILES_ACTIVE: test
            SPRING_DATASOURCE_URL: jdbc:h2:mem:testdb;MODE=MySQL;DB_CLOSE_DELAY=-1;DATABASE_TO_UPPER=false
            SPRING_DATASOURCE_USERNAME: sa
            SPRING_DATASOURCE_PASSWORD: ""
            INCLUDE_INTEGRATION: false

        steps:
            - name: Checkout
              uses: actions/checkout@v4
              with:
                  fetch-depth: 0

            - name: Ensure base commit is fetched (PR only)
              if: github.event_name == 'pull_request'
              run: |
                  BASE_SHA='${{ github.event.pull_request.base.sha }}'
                  if ! git cat-file -e "$BASE_SHA^{commit}" 2>/dev/null; then
                    git fetch --no-tags --prune origin "$BASE_SHA":"refs/remotes/origin/base-sha"
                  fi

            - name: Set up Java 21
              uses: actions/setup-java@v4
              with:
                  distribution: temurin
                  java-version: 21

            - name: Cache Gradle packages
              uses: actions/cache@v3
              with:
                  path: |
                      ~/.gradle/caches
                      ~/.gradle/wrapper
                  key: ${{ runner.os }}-gradle-${{ hashFiles('**/*.gradle*', '**/gradle-wrapper.properties') }}
                  restore-keys: ${{ runner.os }}-gradle-

            - name: Grant execute permission for gradlew
              run: chmod +x gradlew

            - name: Build without tests
              run: ./gradlew build -x test --no-daemon

            - name: Run Unit Tests
              run: ./gradlew clean test --no-daemon

            - name: Run Full Tests (Unit + Integration)
              run: ./gradlew clean fullTest --no-daemon

            - name: Generate JaCoCo Unit Test Report
              if: always()
              run: ./gradlew jacocoTestReport --no-daemon

            - name: Generate JaCoCo Full Test Report
              if: always()
              run: ./gradlew clean jacocoFullTestReport --rerun-tasks --no-daemon

            # í…ŒìŠ¤íŠ¸ ê²°ê³¼ íŒŒì‹±
            - name: Parse test results
              if: always()
              id: test_results
              run: |
                  # fullTest ê²°ê³¼ ìš°ì„  ì‚¬ìš©
                  TEST_DIR="build/test-results/fullTest"
                  
                  if [ -d "$TEST_DIR" ]; then
                    TOTAL=0
                    FAILURES=0
                    SKIPPED=0
                  
                    # XML íŒŒì¼ íŒŒì‹±
                    for xml_file in "$TEST_DIR"/TEST-*.xml; do
                      if [ -f "$xml_file" ]; then
                        tests=$(grep -o 'tests="[0-9]*"' "$xml_file" | head -1 | grep -o '[0-9]*' || echo "0")
                        failures=$(grep -o 'failures="[0-9]*"' "$xml_file" | head -1 | grep -o '[0-9]*' || echo "0")
                        skipped=$(grep -o 'skipped="[0-9]*"' "$xml_file" | head -1 | grep -o '[0-9]*' || echo "0")
                  
                        TOTAL=$((TOTAL + tests))
                        FAILURES=$((FAILURES + failures))
                        SKIPPED=$((SKIPPED + skipped))
                      fi
                    done
                  
                    PASSED=$((TOTAL - FAILURES - SKIPPED))
                  
                    echo "Test Results: Total=$TOTAL, Passed=$PASSED, Failed=$FAILURES, Skipped=$SKIPPED"
                    echo "total=$TOTAL" >> $GITHUB_OUTPUT
                    echo "passed=$PASSED" >> $GITHUB_OUTPUT
                    echo "failed=$FAILURES" >> $GITHUB_OUTPUT
                    echo "skipped=$SKIPPED" >> $GITHUB_OUTPUT
                  else
                    echo "No test results found"
                    echo "total=0" >> $GITHUB_OUTPUT
                    echo "passed=0" >> $GITHUB_OUTPUT
                    echo "failed=0" >> $GITHUB_OUTPUT
                    echo "skipped=0" >> $GITHUB_OUTPUT
                  fi

            - name: Publish Unit Test Results
              if: always()
              uses: EnricoMi/publish-unit-test-result-action@v2
              with:
                  files: |
                      build/test-results/test/*.xml
                  check_run: true
                  comment_mode: always

            - name: Publish Full Test Results
              if: always()
              uses: EnricoMi/publish-unit-test-result-action@v2
              with:
                  files: |
                      build/test-results/fullTest/*.xml
                  check_run: true
                  comment_mode: always

            - name: Upload failed-tests.txt (if exists)
              if: always()
              uses: actions/upload-artifact@v4
              with:
                  name: failed-tests
                  path: build/reports/tests/failed-tests.txt
                  if-no-files-found: ignore

            - name: Upsert PR comment with failed tests
              if: always()
              uses: actions/github-script@v7
              with:
                  script: |
                      const fs = require('fs');
                      const path = 'build/reports/tests/failed-tests.txt';
                      const MARK = '<!-- FAILED-TESTS-SUMMARY -->';
                      
                      function buildBody(textBlock) {
                        return [
                          MARK,
                          '### âŒ Failed Tests (from Gradle summary)',
                          '',
                          '<details><summary>Expand</summary>',
                          '',
                          '```text',
                          textBlock,
                          '```',
                          '',
                          '</details>'
                        ].join('\n');
                      }
                      
                      if (!context.payload.pull_request) {
                        core.info('Not a PR event, skip commenting');
                        return;
                      }
                      
                      const { data: comments } = await github.rest.issues.listComments({
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        issue_number: context.payload.pull_request.number,
                        per_page: 100
                      });
                      
                      if (!fs.existsSync(path)) {
                        const existing = comments.find(c => c.user.type === 'Bot' && c.body.includes(MARK));
                        if (existing) {
                          await github.rest.issues.deleteComment({
                            owner: context.repo.owner,
                            repo: context.repo.repo,
                            comment_id: existing.id
                          });
                        }
                        return;
                      }
                      
                      const content = fs.readFileSync(path, 'utf8').trim();
                      if (!content || content === 'No failures ğŸ‰') {
                        const existing = comments.find(c => c.user.type === 'Bot' && c.body.includes(MARK));
                        if (existing) {
                          await github.rest.issues.deleteComment({
                            owner: context.repo.owner,
                            repo: context.repo.repo,
                            comment_id: existing.id
                          });
                        }
                        return;
                      }
                      
                      const body = buildBody(content);
                      const existing = comments.find(c => c.user.type === 'Bot' && c.body.includes(MARK));
                      if (existing) {
                        await github.rest.issues.updateComment({
                          owner: context.repo.owner,
                          repo: context.repo.repo,
                          comment_id: existing.id,
                          body
                        });
                      } else {
                        await github.rest.issues.createComment({
                          owner: context.repo.owner,
                          repo: context.repo.repo,
                          issue_number: context.payload.pull_request.number,
                          body
                        });
                      }

            - name: Upload JaCoCo Unit Test HTML
              if: always()
              uses: actions/upload-artifact@v4
              with:
                  name: jacoco-unit-html
                  path: build/reports/jacoco/html
                  if-no-files-found: warn

            - name: Upload JaCoCo Full Test HTML
              if: always()
              uses: actions/upload-artifact@v4
              with:
                  name: jacoco-full-html
                  path: build/reports/jacocoFull/html
                  if-no-files-found: warn

            - name: Upload JaCoCo XML Reports
              if: always()
              uses: actions/upload-artifact@v4
              with:
                  name: jacoco-xml-reports
                  path: |
                      build/reports/jacoco/xml/jacocoTestReport.xml
                      build/reports/jacocoFull/xml/jacocoFullTestReport.xml
                  if-no-files-found: warn

            - name: Install xmllint
              if: always()
              run: sudo apt-get update && sudo apt-get install -y libxml2-utils

            - name: Compute coverage percentage
              if: always() && github.event_name == 'pull_request'
              id: coverage
              run: |
                  # JaCoCo XML ë¦¬í¬íŠ¸ ì°¾ê¸° (fullTest ìš°ì„ )
                  XML="build/reports/jacocoFull/xml/jacocoFullTestReport.xml"
                  if [ ! -f "$XML" ]; then
                    XML="build/reports/jacoco/xml/jacocoTestReport.xml"
                  fi
                  
                  if [ -f "$XML" ]; then
                    echo "Using coverage XML: $XML"
                  
                    # LINE ì»¤ë²„ë¦¬ì§€ ê³„ì‚°
                    COVERED=$(xmllint --xpath "string(sum(//counter[@type='LINE']/@covered))" "$XML" 2>/dev/null || echo "0")
                    MISSED=$(xmllint --xpath "string(sum(//counter[@type='LINE']/@missed))" "$XML" 2>/dev/null || echo "0")
                  
                    # ìˆ«ì ë³€í™˜
                    COVERED=${COVERED%.*}
                    MISSED=${MISSED%.*}
                  
                    if [ "$COVERED" -eq 0 ] && [ "$MISSED" -eq 0 ]; then
                      PCT="0"
                    else
                      TOTAL=$((COVERED + MISSED))
                      PCT=$(awk "BEGIN { printf \"%.2f\", ($COVERED/$TOTAL)*100 }")
                    fi
                  
                    echo "Coverage: $COVERED covered, $MISSED missed = $PCT%"
                    echo "pct=$PCT" >> $GITHUB_OUTPUT
                    echo "covered=$COVERED" >> $GITHUB_OUTPUT
                    echo "missed=$MISSED" >> $GITHUB_OUTPUT
                  else
                    echo "No coverage XML found"
                    echo "pct=0" >> $GITHUB_OUTPUT
                    echo "covered=0" >> $GITHUB_OUTPUT
                    echo "missed=0" >> $GITHUB_OUTPUT
                  fi

            - name: Build detailed coverage markdown
              if: always() && github.event_name == 'pull_request'
              id: coverage_details
              continue-on-error: true
              run: |
                # ë¦¬í¬íŠ¸ ê²½ë¡œ ê²°ì •
                XML="build/reports/jacocoFull/xml/jacocoFullTestReport.xml"
                if [ ! -f "$XML" ]; then
                    ALT="build/reports/jacoco/xml/jacocoTestReport.xml"
                    if [ -f "$ALT" ]; then
                        XML="$ALT"
                    else
                        echo "details=No coverage report found." >> $GITHUB_OUTPUT
                        exit 0
                    fi
                fi
                echo "Using coverage XML: $XML"
                    
                export XML_PATH="$XML"
                    
                # PR ë³€ê²½ íŒŒì¼ ìˆ˜ì§‘ (Java íŒŒì¼ë§Œ)
                BASE_SHA='${{ github.event.pull_request.base.sha }}'
                HEAD_SHA='${{ github.sha }}'
                    
                # ë² ì´ìŠ¤ ì»¤ë°‹ í™•ì¸
                if ! git cat-file -e "$BASE_SHA^{commit}" 2>/dev/null; then
                  git fetch --no-tags --prune origin "$BASE_SHA":"refs/remotes/origin/base-sha" || true
                fi
                    
                git diff --name-only "$BASE_SHA" "$HEAD_SHA" \
                  | grep -E '^src/main/java/.*\.java$' > /tmp/changed-java.txt || true
                    
                echo "Changed Java files:"
                cat /tmp/changed-java.txt || true
                echo
                    
                python3 <<EOF > /tmp/coverage_details.md
                import os
                import sys
                import xml.etree.ElementTree as ET
                from pathlib import Path
                  
                # XML ê²½ë¡œë¥¼ ëª…ë ¹ì¤„ ì¸ìë‚˜ í™˜ê²½ë³€ìˆ˜ë¡œ ë°›ê¸°
                xml_path = os.environ.get('XML_PATH') or sys.argv[1] if len(sys.argv) > 1 else None

                if not xml_path or not os.path.exists(xml_path):
                    print("### ğŸ“Š ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸")
                    print("> ë¦¬í¬íŠ¸ë¥¼ ìƒì„±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤. XML íŒŒì¼ì´ ì—†ìŠµë‹ˆë‹¤.")
                    sys.exit(0)
                    
                try:
                  root = ET.parse(xml_path).getroot()
                  
                  def sum_counter(node, ctype):
                    for c in node.findall("counter"):
                        if c.get("type") == ctype:
                            return int(c.get("covered", "0")), int(c.get("missed", "0"))
                    return 0, 0
    
                  # ì „ì²´ ì»¤ë²„ë¦¬ì§€
                  tot_cov, tot_miss = sum_counter(root, "LINE")
                  tot_pct = (tot_cov / (tot_cov + tot_miss) * 100) if (tot_cov + tot_miss) else 0.0
                  
                  # íŒ¨í‚¤ì§€ë³„ ì»¤ë²„ë¦¬ì§€
                  pkg_rows = []
                  for p in root.findall("package"):
                    pcov, pmiss = sum_counter(p, "LINE")
                    
                    if pcov + pmiss == 0:
                        for c in p.findall("class"):
                            cc, cm = sum_counter(c, "LINE")
                            pcov += cc; pmiss += cm
                    ppct = (pcov / (pcov + pmiss) * 100) if (pcov + pmiss) else 0.0
                    pkg_rows.append((p.get("name","(default)"), pcov, pmiss, ppct))
                  pkg_rows.sort(key=lambda r: r[3])
    
                  # í´ë˜ìŠ¤ë³„ ì»¤ë²„ë¦¬ì§€
                  class_rows = []
                  for p in root.findall("package"):
                        for c in p.findall("class"):
                            cc, cm = sum_counter(c, "LINE")
                            total = cc + cm
                            pct = (cc/total*100) if total else 0.0
                            cname = c.get("name","(unknown)").replace("/", ".")
                        class_rows.append((cname, cc, cm, pct, total))
                  class_rows.sort(key=lambda r: (r[3], -r[4]))
    
                  # ë³€ê²½ íŒŒì¼ ë§¤í•‘
                  changed_rows = []
                  changed_file_list = Path("/tmp/changed-java.txt")
                  
                  if changed_file_list.exists():
                        for line in changed_file_list.read_text().splitlines():
                            line = line.strip()
                            if not line: continue
                            if line.startswith("src/main/java/"):
                                rel = line[len("src/main/java/"):]
                                if rel.endswith(".java"):
                                    rel = rel[:-5]
                                fqn = rel.replace("/", ".")
                                    
                                matches = [r for r in class_rows if r[0].startswith(fqn)]
                                if matches:
                                    cov = sum(m[1] for m in matches)
                                    miss = sum(m[2] for m in matches)
                                    total = cov + miss
                                    pct = (cov/total*100) if total else 0.0
                                    changed_rows.append((line, fqn, cov, miss, pct, total))
                                else:
                                    changed_rows.append((line, fqn, 0, 0, 0.0, 0))
                        changed_rows.sort(key=lambda r: (r[4], -r[5]))
    
                  def fmt_pct(x): return f"{x:.2f}%"
    
                  print("### ğŸ“Š ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸\\n")
                  print(f"**ì „ì²´ ë¼ì¸ ì»¤ë²„ë¦¬ì§€:** {fmt_pct(tot_pct)} ({tot_cov} covered / {tot_cov+tot_miss} lines)\\n")
    
                  if pkg_rows:
                    print("<details><summary><b>íŒ¨í‚¤ì§€ë³„ ì»¤ë²„ë¦¬ì§€ (ë‚®ì€ ìˆœ)</b></summary>\\n")
                    print("| íŒ¨í‚¤ì§€ | ë¼ì¸ % | ì»¤ë²„ë¨ | ë†“ì¹¨ |")
                    print("|---|---:|---:|---:|")
                    for (name, cov, miss, pct) in pkg_rows:
                        print(f"| \`{name}\` | {fmt_pct(pct)} | {cov} | {miss} |")
                    print("\\n</details>\\n")
    
                  print("<details open><summary><b>ì»¤ë²„ë¦¬ì§€ê°€ ë‚®ì€ í´ë˜ìŠ¤ (Top 15)</b></summary>\\n")
                  print("| í´ë˜ìŠ¤ | ë¼ì¸ % | ì»¤ë²„ë¨ | ë†“ì¹¨ |")
                  print("|---|---:|---:|---:|")
                  for (cname, cov, miss, pct, total) in class_rows[:15]:
                        print(f"| \`{cname}\` | {fmt_pct(pct)} | {cov} | {miss} |")
                  print("\\n</details>\\n")
    
                  if changed_rows:
                        print("<details open><summary><b>ì´ PRì—ì„œ ë³€ê²½ëœ íŒŒì¼ë“¤</b></summary>\\n")
                        print("| íŒŒì¼ (PR) | í´ë˜ìŠ¤ | ë¼ì¸ % | ì»¤ë²„ë¨ | ë†“ì¹¨ |")
                        print("|---|---|---:|---:|---:|")
                        for (src, fqn, cov, miss, pct, total) in changed_rows:
                            print(f"| \`{src}\` | \`{fqn}\` | {fmt_pct(pct)} | {cov} | {miss} |")
                            
                        print("\\n</details>\\n")
                  else:
                        print("> ì´ PRì—ëŠ” Java ì†ŒìŠ¤ íŒŒì¼ ë³€ê²½ì´ ì—†ìŠµë‹ˆë‹¤.\\n")
    
                except Exception as e:
                    print(f"### ğŸ“Š ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸")
                    print(f"> ì˜¤ë¥˜ ë°œìƒ: {e}")
                    print("> ê¸°ë³¸ ë¦¬í¬íŠ¸ë§Œ í‘œì‹œë©ë‹ˆë‹¤.")
                EOF
                      
                    {
                        echo 'details<<EOF'
                        cat /tmp/coverage_details.md
                        echo 'EOF'
                    } >> $GITHUB_OUTPUT

            - name: Upsert PR coverage comment
              if: always() && github.event_name == 'pull_request'
              uses: actions/github-script@v7
              env:
                  PCT: ${{ steps.coverage.outputs.pct }}
                  COVERED: ${{ steps.coverage.outputs.covered }}
                  MISSED: ${{ steps.coverage.outputs.missed }}
                  DETAILS: ${{ steps.coverage_details.outputs.details }}
              with:
                  script: |
                      const MARK = '<!-- JACOCO-COVERAGE-REPORT -->';
                      const pct = process.env.PCT || '0';
                      const covered = process.env.COVERED || '0';
                      const missed = process.env.MISSED || '0';
                      const details = process.env.DETAILS || '';
                      const runUrl = `https://github.com/${context.repo.owner}/${context.repo.repo}/actions/runs/${context.runId}`;
                      
                      const body = `${MARK}
                      ## ğŸ§ª ì½”ë“œ ì»¤ë²„ë¦¬ì§€ ë¦¬í¬íŠ¸
                      
                      ### ğŸ“ˆ ì „ì²´ í†µê³„
                      **ë¼ì¸ ì»¤ë²„ë¦¬ì§€:** ${pct}% (${covered} lines covered / ${parseInt(covered) + parseInt(missed)} total)
                      
                      ${details}
                      
                      ### ğŸ”— ë¦¬í¬íŠ¸ ë³´ê¸°
                      - **HTML ë¦¬í¬íŠ¸**: [jacoco-full-html ì•„í‹°íŒ©íŠ¸](${runUrl})
                      - **í…ŒìŠ¤íŠ¸ ê²°ê³¼**: [í…ŒìŠ¤íŠ¸ ë¦¬í¬íŠ¸](${runUrl})
                      - **ì‹¤íŒ¨ í…ŒìŠ¤íŠ¸**: PR ì½”ë©˜íŠ¸ í™•ì¸
                      
                      > *ğŸ¤– ì´ ë¦¬í¬íŠ¸ëŠ” DROP CIì— ì˜í•´ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤.*`;
                      
                      const { data: comments } = await github.rest.issues.listComments({
                        owner: context.repo.owner,
                        repo: context.repo.repo,
                        issue_number: context.payload.pull_request.number,
                        per_page: 100
                      });
                      
                      const existing = comments.find(c => c.user.type === 'Bot' && c.body.includes(MARK));
                      if (existing) {
                        await github.rest.issues.updateComment({
                          owner: context.repo.owner,
                          repo: context.repo.repo,
                          comment_id: existing.id,
                          body
                        });
                      } else {
                        await github.rest.issues.createComment({
                          owner: context.repo.owner,
                          repo: context.repo.repo,
                          issue_number: context.payload.pull_request.number,
                          body
                        });
                      }

            # Slack ì•Œë¦¼ (í…ŒìŠ¤íŠ¸ ê²°ê³¼ì™€ ì»¤ë²„ë¦¬ì§€ í¬í•¨)
            - name: Slack ì•Œë¦¼ (ì„±ê³µ)
              if: success()
              uses: slackapi/slack-github-action@v1
              continue-on-error: true
              with:
                  payload: |
                      {
                        "text": "âœ… Backend CI ì„±ê³µ - ${{ github.repository }}\nBranch: ${{ github.ref_name }}\nAuthor: ${{ github.actor }}\nTests: âœ… ${{ steps.test_results.outputs.passed || 0 }} passed\nCoverage: ${{ steps.coverage.outputs.pct || 0 }}%",
                        "blocks": [
                          {
                            "type": "header",
                            "text": {
                              "type": "plain_text",
                              "text": "âœ… Backend CI ì„±ê³µ",
                              "emoji": true
                            }
                          },
                          {
                            "type": "section",
                            "fields": [
                              {
                                "type": "mrkdwn",
                                "text": "*Branch/PR*\n${{ github.ref_name }}"
                              },
                              {
                                "type": "mrkdwn",
                                "text": "*Author*\n${{ github.actor }}"
                              }
                            ]
                          },
                          {
                            "type": "section",
                            "fields": [
                              {
                                "type": "mrkdwn",
                                "text": "*Tests*\nâœ… ${{ steps.test_results.outputs.passed || 0 }} passed\nâŒ ${{ steps.test_results.outputs.failed || 0 }} failed\nâ­ï¸ ${{ steps.test_results.outputs.skipped || 0 }} skipped"
                              },
                              {
                                "type": "mrkdwn",
                                "text": "*Coverage*\n${{ steps.coverage.outputs.pct || 0 }}%"
                              }
                            ]
                          },
                          {
                            "type": "section",
                            "text": {
                              "type": "mrkdwn",
                              "text": "ğŸ”— <https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}|ë¡œê·¸ í™•ì¸í•˜ê¸°>"
                            }
                          }
                        ]
                      }
              env:
                  SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}

            - name: Slack ì•Œë¦¼ (ì‹¤íŒ¨)
              if: failure()
              uses: slackapi/slack-github-action@v1
              continue-on-error: true
              with:
                  payload: |
                      {
                        "text": "âŒ Backend CI ì‹¤íŒ¨ - ${{ github.repository }}\nBranch: ${{ github.ref_name }}\nAuthor: ${{ github.actor }}\nTests: âœ… ${{ steps.test_results.outputs.passed || 0 }} passed, âŒ ${{ steps.test_results.outputs.failed || 0 }} failed\nView: https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}",
                        "blocks": [
                          {
                            "type": "header",
                            "text": {
                              "type": "plain_text",
                              "text": "âŒ Backend CI ì‹¤íŒ¨",
                              "emoji": true
                            }
                          },
                          {
                            "type": "section",
                            "fields": [
                              {
                                "type": "mrkdwn",
                                "text": "*Branch/PR*\n${{ github.ref_name }}"
                              },
                              {
                                "type": "mrkdwn",
                                "text": "*Author*\n${{ github.actor }}"
                              }
                            ]
                          },
                          {
                            "type": "section",
                            "fields": [
                              {
                                "type": "mrkdwn",
                                "text": "*Tests*\nâœ… ${{ steps.test_results.outputs.passed || 0 }} passed\nâŒ ${{ steps.test_results.outputs.failed || 0 }} failed"
                              },
                              {
                                "type": "mrkdwn",
                                "text": "*Coverage*\n${{ steps.coverage.outputs.pct || 0 }}%"
                              }
                            ]
                          },
                          {
                            "type": "section",
                            "text": {
                              "type": "mrkdwn",
                              "text": "ğŸ”— <https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}|ë¡œê·¸ í™•ì¸í•˜ê¸°>"
                            }
                          }
                        ]
                      }
              env:
                  SLACK_WEBHOOK_URL: ${{ secrets.SLACK_WEBHOOK_URL }}
